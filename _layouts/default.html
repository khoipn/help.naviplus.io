<!DOCTYPE html>
<html lang="en">
  <head>
    {% include head.html %}
    <link rel="stylesheet" href="{{ '/theme/assets/css/theme-styles.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/theme/assets/css/lightbox-styles.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/theme/assets/css/print-styles.css' | relative_url }}" media="print">
  </head>
  <body class="d-flex flex-column min-vh-100">
    {% include navbar.html %}
    <div class="container-fluid flex-grow-1">
      <div class="row">
        <!-- Offcanvas Sidebar for Mobile -->
        <div class="offcanvas offcanvas-start bg-light sidebar-offcanvas d-md-none" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
          <div class="offcanvas-header shadow-sm border-bottom">
            <h5 class="offcanvas-title" id="offcanvasSidebarLabel">{{ site.title }}</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body p-0">
            <!-- Sidebar content -->
            <nav class="bg-light sidebar h-100">
              <div class="position-sticky pt-3 h-100">
                {% include sidebar.html %}
              </div>
            </nav>
          </div>
        </div>

        <!-- Sidebar for Desktop/Tablet -->
        <nav class="col-md-3 col-lg-2 d-none d-md-block bg-light sidebar shadow-sm border-end">
          <div class="position-sticky pt-3 h-100">
            {% include sidebar.html %}
          </div>
        </nav>

        <!-- Main Content -->
        <main class="col-12 col-md-9 ms-sm-auto col-lg-10 px-md-4 py-3">
          
          <div class="content-wrapper">
            {{ content }}
          </div>
        </main>
      </div>
    </div>
    {% include article_actions.html %}
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="{{ '/theme/assets/js/sidebar.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/navbar-links.js' | relative_url }}"></script> <!-- New: Include navbar-links.js -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const navLinksContainer = document.getElementById('main-navbar-nav-links');

        function createNavbarLinks(links, parentElement) {
          links.forEach(linkData => {
            const li = document.createElement('li');
            li.className = 'nav-item';

            if (linkData.children && linkData.children.length > 0) {
              // It's a dropdown parent
              li.classList.add('dropdown');

              const a = document.createElement('a');
              a.className = 'nav-link dropdown-toggle';
              a.href = linkData.url; // Parent link can still have a URL
              a.textContent = linkData.title;
              a.setAttribute('role', 'button');
              a.setAttribute('data-bs-toggle', 'dropdown');
              a.setAttribute('aria-expanded', 'false');
              if (linkData.external) {
                a.target = '_';
                a.rel = 'noopener';
              }
              li.appendChild(a);

              const ul = document.createElement('ul');
              ul.className = 'dropdown-menu';
              li.appendChild(ul);

              createNavbarLinks(linkData.children, ul); // Recursively create children
            } else {
              // It's a regular link
              const a = document.createElement('a');
              a.className = 'nav-link';
              a.href = linkData.url;
              a.textContent = linkData.title;
              if (linkData.external) {
                a.target = '_';
                a.rel = 'noopener';
              }

              // Add active class if current page matches
              const currentPathname = window.location.pathname;
              const baseUrl = '{{ site.baseurl | relative_url }}'.endsWith('/') ? '{{ site.baseurl | relative_url }}'.slice(0, -1) : '{{ site.baseurl | relative_url }}';
              const normalizedLinkUrl = linkData.url.startsWith(baseUrl) ? linkData.url.substring(baseUrl.length) : linkData.url;
              const normalizedCurrentPath = currentPathname.startsWith(baseUrl) ? currentPathname.substring(baseUrl.length) : currentPathname;

              if (normalizedCurrentPath === normalizedLinkUrl || (normalizedLinkUrl === '/' && normalizedCurrentPath === '/')) {
                  a.classList.add('active');
              }
              li.appendChild(a);
            }
            parentElement.appendChild(li);
          });
        }

        if (navLinksContainer && typeof navbarLinks !== 'undefined') {
          createNavbarLinks(navbarLinks, navLinksContainer);
        }
      });
    </script>
    <script src="{{ '/theme/assets/js/lightbox.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/article-actions.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/favorites.js' | relative_url }}"></script>
    <footer class="sidebar-footer-fixed">
      {% include footer.html %}
    </footer>
  </body>
</html>
