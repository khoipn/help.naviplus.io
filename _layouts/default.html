<!DOCTYPE html>
<html lang="en">
  <head>
    {% include head.html %}
    <link rel="stylesheet" href="{{ '/theme/assets/css/theme-styles.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/theme/assets/css/lightbox-styles.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/theme/assets/css/print-styles.css' | relative_url }}" media="print">
  </head>
  <body class="d-flex flex-column min-vh-100">
    {% include navbar.html %}
    <div class="container-fluid flex-grow-1">
      <div class="row">
        <!-- Offcanvas Sidebar for Mobile -->
        <div class="offcanvas offcanvas-start bg-light sidebar-offcanvas d-md-none" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
          <div class="offcanvas-header shadow-sm border-bottom">
            <h5 class="offcanvas-title" id="offcanvasSidebarLabel">{{ site.title }}</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body p-0">
            <!-- Sidebar content -->
            <nav class="bg-light sidebar h-100">
              <div class="position-sticky pt-3 h-100">
                {% include sidebar.html %}
              </div>
            </nav>
          </div>
        </div>

        <!-- Sidebar for Desktop/Tablet -->
        <nav class="col-md-3 col-lg-2 d-none d-md-block bg-light sidebar shadow-sm border-end">
          <div class="position-sticky pt-3 h-100">
            {% include sidebar.html %}
          </div>
        </nav>

        <!-- Main Content -->
        <main class="col-12 col-md-9 ms-sm-auto col-lg-10 px-md-4 py-3">
          
          <div class="content-wrapper">
            {{ content }}
          </div>
          
          <!-- Table of Contents (Right sidebar) -->
          <aside id="tableOfContents" class="d-none">
            <div class="toc-title">ON THIS PAGE</div>
          </aside>
        </main>
      </div>
    </div>
    {% include article_actions.html %}
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="{{ '/theme/assets/js/sidebar.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/navbar-links.js' | relative_url }}"></script> <!-- New: Include navbar-links.js -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const navLinksContainer = document.getElementById('main-navbar-nav-links');

        function createNavbarLinks(links, parentElement) {
          links.forEach(linkData => {
            // Handle divider
            if (linkData.divider) {
              const li = document.createElement('li');
              const hr = document.createElement('hr');
              hr.className = 'dropdown-divider';
              li.appendChild(hr);
              parentElement.appendChild(li);
              return;
            }

            const li = document.createElement('li');
            const isDropdownItem = parentElement.classList.contains('dropdown-menu');
            
            if (linkData.dropdown && linkData.children && linkData.children.length > 0) {
              // It's a dropdown parent
              li.className = 'nav-item dropdown';

              const a = document.createElement('a');
              a.className = 'nav-link dropdown-toggle';
              a.href = '#';
              a.textContent = linkData.title;
              a.setAttribute('role', 'button');
              a.setAttribute('data-bs-toggle', 'dropdown');
              a.setAttribute('aria-expanded', 'false');
              
              // Add active class to dropdown toggle if activePage is set
              if (linkData.activePage) {
                a.classList.add('active');
              }
              
              li.appendChild(a);

              const ul = document.createElement('ul');
              ul.className = 'dropdown-menu';
              li.appendChild(ul);

              createNavbarLinks(linkData.children, ul);
            } else {
              // It's a regular link
              if (isDropdownItem) {
                // Dropdown item
                const a = document.createElement('a');
                a.className = 'dropdown-item';
                a.href = linkData.url;
                a.textContent = linkData.title;
                if (linkData.target) {
                  a.target = linkData.target;
                  a.rel = 'noopener noreferrer';
                }
                if (linkData.active) {
                  a.classList.add('active');
                }
                li.appendChild(a);
              } else {
                // Top-level nav item
                li.className = 'nav-item';
                const a = document.createElement('a');
                a.className = 'nav-link';
                a.href = linkData.url;
                a.textContent = linkData.title;
                
                if (linkData.target) {
                  a.target = linkData.target;
                  a.rel = 'noopener noreferrer';
                }

                // Add active class if activePage is set
                if (linkData.activePage) {
                  a.classList.add('active');
                }
                
                li.appendChild(a);
              }
            }
            parentElement.appendChild(li);
          });
        }

        if (navLinksContainer && typeof navbarLinks !== 'undefined') {
          createNavbarLinks(navbarLinks, navLinksContainer);
          
          // Add CTA button if defined
          if (typeof navbarCTA !== 'undefined') {
            const ctaLink = document.createElement('a');
            ctaLink.className = navbarCTA.class;
            ctaLink.href = navbarCTA.url;
            ctaLink.textContent = navbarCTA.text;
            if (navbarCTA.target) {
              ctaLink.target = navbarCTA.target;
              ctaLink.rel = 'noopener noreferrer';
            }
            navLinksContainer.parentElement.appendChild(ctaLink);
          }
        }
      });
    </script>
    <script src="{{ '/theme/assets/js/lightbox.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/article-actions.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/favorites.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/image-placeholder.js' | relative_url }}"></script>
    <script src="{{ '/theme/assets/js/table-of-contents.js' | relative_url }}"></script>
    <footer class="sidebar-footer-fixed">
      {% include footer.html %}
    </footer>
  </body>
</html>
